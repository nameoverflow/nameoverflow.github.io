<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>nameoverflow</title>
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css'><!-- hexo-inject:end -->
</head>

<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/header.png)">
        <div class='av-pic' style="background-image: url(/assets/tree_small.png)">
        </div>
    </section>
    <section class='menu'>
        <div>nameoverflow</div>
        
            <div>What the f__k?</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>Tags</li>
            </a>  
          
            <a href="/about/" class="Btn">
              <li>About</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a href="https://github.com/nameoverflow">
                    <img src="/assets/github.svg" />
                </a>
            
        
            
                <a href="https://www.facebook.com/profile.php?id=100004252391322">
                    <img src="/assets/facebook.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <ul class="Index">
  
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/13/Windows 输入法的 metro 应用兼容性改造/">〔吐槽向〕Wdindows 输入法的 metro 应用兼容性改造</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-13T13:51:55.000Z" itemprop="datePublished">
    2018-01-13
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/input-method/">input method</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/windows/">windows</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/named-pipe/">named pipe</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/interprocess/">interprocess</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>微软真是坑爹不允许在 UWP 里用共享内存结果小狼毫就挂了，改成用 Windows 的 <code>named pipe</code> 来做跨进程交互后就可以用了。</p>
<h2 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h2><p>重新捡起五笔后，一直苦恼没有一个合用的五笔输入法。身为半个初学者，很看中的一个功能就是五笔反查——总不能每个不会的字都专门打开一个反查工具；而 Windows 自带的五笔只有一个并不好用的五笔拼音混输功能。各种老牌的五笔输入法要么面界太丑要么久不更新，更有甚者会摆出一幅流氓作派。</p>
<p>几年之前试水过 RIME 输入法，知道它是一个很强大的输入法，可以满足各种定制需求。但是当初的我并没有开发能力，RIME 的定制又稍显复杂，于是并没有继续下去。现在有了需求后回头看，发现 RIME 无疑是最适合现在的我的。</p>
<p>但是现在要在 Windows 下使用 RIME 却有了个当初没有的新问题——兼容性。作为第一批 Windows 10 用户，无疑需要一个能够在 UWP 应用下正常使用的输入法。但是 RIME 最初的 Windows 前端「小狼毫」却对从 Windows 8 开始的 Metro 应用——包括 Windows 10 的 UWP 都不兼容。原作者也因为无暇分身而<a href="https://github.com/rime/home/issues/25">放弃了「小狼毫」的维护</a>；其它开发者实现的其它前端又存在各种不稳定的问题——比如 RIME 吧的用户将 RIME 移植到了一个叫作 <a href="https://github.com/EasyIME/PIME">PIME</a> 的输入法框架下，这个框架的界面实现非常的搓，除此之外它的输入服务实现也很蛋疼，经常崩溃，也没有可靠的异常处理，很多时候需要手动重启输入服务。</p>
<p>开源界的一大准则就是「你行你上」和「show me the code」。当年使用小狼毫的时候没有经历过什么异常崩溃，说明它在这方面的设计是十分优秀的；现在的主要问题也就是不兼容 Metro 应用而已。既然现在自己有了开发能力，不如自已维护一下，方便自己，也方便他人。</p>
        
          <div class="more-link">
            <a href="/2018/01/13/Windows 输入法的 metro 应用兼容性改造/#more">Read On »</a>
          </div>
        
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/06/Miko-Geisha-的半残编译器/">Miko: Geisha 的半残编译器</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-06T07:13:23.000Z" itemprop="datePublished">
    2018-01-06
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/programming-language/">programming language</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/compiler/">compiler</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/rust/">rust</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <p>人的命运就是这么不可预料，最后 Geisha 的编译器实现居然是作为学校的课程设计在考研期间抽空肝出来的。</p>
<p>因为各种因素，最后交上去的结果和预想的其实差了挺远——比如没来得及实现 GC 所以闭包是残缺的；比如自定义类型根本就没有。不过总归最后做成了一个有结果的东西（虽然是半残的）。</p>
<p>这篇是暑假期间作为课程报告交上去的文档。至于后续的工作，虽然现在已经考完研了但是突然又多出了一堆事情，只能看看什么时候有空能继续完善了……</p>
<p>代码当然也<a href="https://github.com/geisha-lang/miko">在 GitHub 上</a>，只不过 star 都点在了之前那个 Haskell 写的前端 demo 上，这个就无人问津 emmmm</p>
<h2 id="整体设计"><a href="#整体设计" class="headerlink" title="整体设计"></a>整体设计</h2><p>利用了 <a href="https://github.com/kevinmehall/rust-peg">rust-peg</a> 生成语法分析程序，以 LLVM 为代码生成后端。</p>
        
          <div class="more-link">
            <a href="/2018/01/06/Miko-Geisha-的半残编译器/#more">Read On »</a>
          </div>
        
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2017/09/04/如何编译函数闭包/">如何编译函数闭包</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2017-09-04T08:16:53.000Z" itemprop="datePublished">
    2017-09-04
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/functional-programming/">functional programming</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/compile/">compile</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <p>// 知乎不仅不给我开专栏还说我这篇文章zz敏感，破网站吃枣药丸</p>
<blockquote>
<p> <strong>闭包</strong>（英语：Closure），又称<strong>词法闭包</strong>（Lexical Closure）或<strong>函数闭包</strong>（function closures），是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。闭包在运行时可以有多个实例，不同的引用环境和相同的函数组合可以产生不同的实例。</p>
</blockquote>
<p>想要实现一个同时支持词法作用域与 first-class function 的编程语言，一个重要的转换就是所谓的 lambda-lifting：把嵌套函数定义（包括匿名函数）转换为独立的全局函数定义；把自由变量的引用转换为参数传递。</p>
        
          <div class="more-link">
            <a href="/2017/09/04/如何编译函数闭包/#more">Read On »</a>
          </div>
        
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2017/05/11/plagiarism-detection/">基于 Hash 与 Winnowing 方法的文档查重</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2017-05-11T15:20:08.000Z" itemprop="datePublished">
    2017-05-11
  </time>
  
  
</div>

    </header>
    <div>
      
        <blockquote>
<p>这只是一篇实验报告</p>
</blockquote>
<h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><p>基于现实计算能力考虑，许多大段文档之间的相似性比较不可能使用传统的文本 diff 算法等耗时长的方法。Hash 值可以在一定程度上反应数据的特征；但是一般的 Hash 方法强调避免碰撞，源数据的少许改变就可以引起 Hash 值的较大变化。对于查重来说，需要提取出文档的特征，这个特征在源数据相似时也应具有相似性。</p>
<p>Winnowing 方法是 Saul Schleimer 等提出的提取文档特征（文档指纹）的方法。通过对文档的 K-gram 序列进行 hash ，提取出能够反应文档相似性的特征值序列，再对这个特征值序列进行比较[1]，得到的相同特征值的比例即可反映出文档之间的相似性。</p>
        
          <div class="more-link">
            <a href="/2017/05/11/plagiarism-detection/#more">Read On »</a>
          </div>
        
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2017/04/09/Windows-LLVM-环境的二三事/">Windows LLVM 环境的二三事</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2017-04-08T17:44:05.000Z" itemprop="datePublished">
    2017-04-09
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/LLVM/">LLVM</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/compile/">compile</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <p>讲道理，考研党被这种配环境的事情打扰了咸鱼的生活是很不开心的。</p>
<p>起因是 Haskell 的 LLVM binding —— <code>llvm-general</code> 在 Hackage 上只支持到 3.5 版本。当然 repo 里是有后续版本的，但是作者在 issues 里说后续的版本并没有弄好。</p>
<p>既然如此那就装 3.5 吧。然而下载了 LLVM 3.5.2 的源码后，Cmake 很顺利，用 VS 2017 打开也很顺利，然而编译的时候报错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">这里假装有编译 log （好吧忘记存了）</div></pre></td></tr></table></figure>
<p>总之就是某个类的方法后有 const 限定符，然后调用的上下文却又不是返回 const 于是不给过。</p>
<p>奇怪的是报错的位置是 VS 提供的标准库文件。这就很尴尬了。我要么改 VS 的标准库要么研究一波 LLVM 源码。</p>
<p>在 WSL 里试了一下，无痛编译。看来是 VS 有什么蛋疼的限制。网上稍微搜了一圈也没发现有类似情况（毕竟 3.5 的年代他们还没官方支持 VS 编译吧）。于是决定上 MinGW 来构建。</p>
<p>使用 CMake 生成 MinGW 的 makefile 并没有问题，然而在 make 的时候提示命令语法错误</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">命令语法不正确。</div><div class="line">mingw32-make.exe[2]: *** [tools\lto\CMakeFiles\LTO_exports.dir\build.make:61: tools/lto/LTO.def] Error 1</div><div class="line">mingw32-make.exe[2]: *** Deleting file &apos;tools/lto/LTO.def&apos;</div><div class="line">mingw32-make.exe[1]: *** [CMakeFiles\Makefile2:9977: tools/lto/CMakeFiles/LTO_exports.dir/all] Error 2</div><div class="line">mingw32-make.exe: *** [Makefile:151: all] Error 2</div></pre></td></tr></table></figure>
<p>找到了这个 build.make 发现这一行的命令很奇怪</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line">cd /d C:\Users\hcyue\code\llvm-<span class="number">3.5</span>.<span class="number">2</span>.build\tools\lto &amp;&amp; <span class="string">"C:\Program Files\CMake\bin\cmake.exe"</span> -E echo EXPORTS &gt; LTO.def</div><div class="line">cd /d C:\Users\hcyue\code\llvm-<span class="number">3.5</span>.<span class="number">2</span>.build\tools\lto &amp;&amp; type C:/Users/hcyue/code/llvm-<span class="number">3.5</span>.<span class="number">2</span>.src/tools/lto/lto.exports &gt;&gt; LTO.def</div></pre></td></tr></table></figure>
<p><del>纵横 Windows 这么多年没见过 cd 还可以带个 <code>/d</code> 参数的</del> 似乎 powershell 的 cd 并不支持 /d 参数。那把它删了吧。</p>
<p>之后继续报错，link 的时候找不到 symbol。发现是刚刚改的那两行生成的目标文件 <code>LTO.def</code> 有问题，不知道为什么没有写入成正常的文本文件，而是二进制文件（VS code 打开提示文件过大或为二进制文件）。直接 <code>type</code> 出来是一个奇怪的、字距拉得很开的、看起来像是文本文件的格式。很气。</p>
<p>然而既然 <code>.def</code> 反正是文本文件，我大不了手动构建一下 <code>def</code> 。于是手动运行命令把 <code>lto.exports</code> 里的东西 <code>type</code> 出来</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line">type C:/Users/hcyue/code/llvm-<span class="number">3.5</span>.<span class="number">2</span>.src/tools/lto/lto.exports</div></pre></td></tr></table></figure>
<p>得到一大堆符号名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">lto_get_error_message</div><div class="line">lto_get_version</div><div class="line">lto_initialize_disassembler</div><div class="line">lto_module_create</div><div class="line">lto_module_create_from_fd</div><div class="line">lto_module_create_from_fd_at_offset</div><div class="line">lto_module_create_from_memory</div><div class="line"></div><div class="line">（……一大堆 lto 符号名）</div><div class="line"></div><div class="line">LLVMCreateDisasm</div><div class="line">LLVMCreateDisasmCPU</div><div class="line">LLVMDisasmDispose</div><div class="line">LLVMDisasmInstruction</div><div class="line">LLVMSetDisasmOptions</div></pre></td></tr></table></figure>
<p>新建个 <code>LTO.def</code> 把原来的覆盖掉，贴进去。</p>
<p>重新运行 <code>cmake --build .</code> ，终于过了。</p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2017/03/03/使用-Parsec-处理左递归/">使用 Parsec 处理左递归</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2017-03-03T12:41:36.000Z" itemprop="datePublished">
    2017-03-03
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/haskell/">haskell</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/compile/">compile</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/parsec/">parsec</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <p>在给之前写的 Lisp 解释器之前套上表达式语法时，遇到这样几条文法</p>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>→</mo><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>s</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>→</mo><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mo separator="true">,</mo><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>s</mi></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>→</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">∣</mi><mi>A</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>y</mi><mi mathvariant="normal">∣</mi><mi>I</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>f</mi><mi>y</mi><mi mathvariant="normal">∣</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">∣</mi><mrow><mo>(</mo></mrow><mrow><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi></mrow><mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>g</mi><mi>e</mi><mi>r</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>→</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr><mtr><mtd><mrow><mi>A</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>y</mi></mrow></mtd><mtd><mrow><mrow></mrow><mo>→</mo><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mi>r</mi><mi>s</mi><mo>)</mo></mrow></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{aligned}
Expr &amp; \rightarrow Factor ... \\\\
Exprs &amp; \rightarrow Expr  ,  Exprs\\\\
 Factor &amp; \rightarrow Integer|Apply|Identify|...|{(}  {Expr} {)} \\\\
  Integer &amp; \rightarrow... \\\\
...\\\\
 Apply &amp; \rightarrow  Factor  (  Exprs  )
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:6.849999999999999em;"></span><span class="strut bottom" style="height:13.2em;vertical-align:-6.35em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-6.009999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span style="top:-4.809999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:-3.609999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span></span></span><span style="top:-2.409999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:-1.209999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span style="top:-0.009999999999997733em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.1900000000000024em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span style="top:2.390000000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:3.590000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span></span></span><span style="top:4.79em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:5.989999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">A</span><span class="mord mathit">p</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-6.009999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">→</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span></span></span><span style="top:-3.6099999999999985em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">→</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span></span></span><span style="top:-1.2099999999999989em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">→</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathrm">∣</span><span class="mord mathit">A</span><span class="mord mathit">p</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">∣</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathrm">∣</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">∣</span><span class="mord displaystyle textstyle uncramped"><span class="mopen">(</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span><span class="mord displaystyle textstyle uncramped"><span class="mclose">)</span></span></span></span><span style="top:1.1900000000000015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">→</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span><span class="mord mathrm">.</span></span></span><span style="top:5.989999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mrel">→</span><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mord mathit">x</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">s</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></span></span>
<p>显然，non-terminal <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">Apply</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span><span class="mord mathit">p</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> 的派生最左端会进入  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">Factor</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit">t</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span></span> ，之后又会回到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">Apply</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span><span class="mord mathit">p</span><span class="mord mathit">p</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> 。教科书式的左递归。</p>
        
          <div class="more-link">
            <a href="/2017/03/03/使用-Parsec-处理左递归/#more">Read On »</a>
          </div>
        
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2016/08/24/Call-With-Current-Continuation-Coroutine/">Call With Current Continuation: Coroutine</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2016-08-24T14:33:53.000Z" itemprop="datePublished">
    2016-08-24
  </time>
  
  
</div>

    </header>
    <div>
      
        <p>通过嵌套 <code>call/cc</code> 可以方便的实现协程</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">(define (coroutine routine)</div><div class="line">  (let ((current routine)</div><div class="line">        (status 'suspended))</div><div class="line">    (lambda args</div><div class="line">      (cond ((null? args) </div><div class="line">             (if (eq? status 'dead)</div><div class="line">                 (error 'dead-coroutine)</div><div class="line">                 (let ((continuation-and-value</div><div class="line">                        (call/cc (lambda (return)</div><div class="line">                                   (let ((returner</div><div class="line">                                          (lambda (value)</div><div class="line">                                            (call/cc (lambda (next)</div><div class="line">                                                       (return (cons next value)))))))</div><div class="line">                                     (current returner)</div><div class="line">                                     (set! status 'dead))))))</div><div class="line">                   (if (pair? continuation-and-value)</div><div class="line">                       (begin (set! current (car continuation-and-value))</div><div class="line">                              (cdr continuation-and-value))</div><div class="line">                       continuation-and-value))))</div><div class="line">            ((eq? (car args) 'status?) status)</div><div class="line">            ((eq? (car args) 'dead?) (eq? status 'dead))</div><div class="line">            ((eq? (car args) 'alive?) (not (eq? status 'dead)))</div><div class="line">            ((eq? (car args) 'kill!) (set! status 'dead))</div><div class="line">            (true nil)))))</div></pre></td></tr></table></figure>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2016/08/01/Write-You-a-Scheme/">Write You a Scheme</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2016-08-01T01:33:57.000Z" itemprop="datePublished">
    2016-08-01
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/haskell/">haskell</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/scheme/">scheme</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/interpreter/">interpreter</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/lambda-calculus/">lambda calculus</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <p>撸了个 <a href="https://github.com/nameoverflow/LittleScheme">Scheme 解释器</a>，也算是拿 Haskell 做过东西了（虽然只是个玩具</p>
<p>最大的体会就是，既熟悉了 Haskell，也巩固了 Scheme （虽然看过 SICP 但是并不是很明白它的 quosiquote 和 call/cc 之类的鬼东西</p>
<p>本来是打算自己定义一门语言（像<a href="https://hcyue.me/article/56eb92c6d09a19dd0956c469">这个</a>），但是发现挺麻烦的（大雾），而且我比较关心的也是解释执行的过程，于是还是决定把 Scheme 实现一下。大体上是跟着 <a href="https://en.wikibooks.org/wiki/Write_Yourself_a_Scheme_in_48_Hours">Write Yourself a Scheme in 48 Hours</a> 来的，在它的基础上增加了 Continuation 之类的玩意儿</p>
        
          <div class="more-link">
            <a href="/2016/08/01/Write-You-a-Scheme/#more">Read On »</a>
          </div>
        
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2016/05/14/什么是函数式编程思维/">什么是函数式编程思维？</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2016-05-14T06:00:30.000Z" itemprop="datePublished">
    2016-05-14
  </time>
  
  | 
  <ul>
    
  <li class="meta-text">
  { <a href="/tags/functional-programming/">functional programming</a> }
  </li>


  </ul>
  
  
</div>

    </header>
    <div>
      
        <p>我为什么要把我的知乎回答搬到这里呢……大概是太久没发东西了来凑数吧。</p>
<p>作者：nameoverflow</p>
<p>链接：<a href="https://www.zhihu.com/question/28292740/answer/100284611" target="_blank" rel="external">https://www.zhihu.com/question/28292740/answer/100284611</a></p>
<p>来源：知乎</p>
<p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p>函数式编程与命令式编程最大的不同其实在于：</p>
<p><strong>函数式编程关心数据的映射，命令式编程关心解决问题的步骤</strong></p>
<p>这里的映射就是数学上“函数”的概念——一种东西和另一种东西之间的对应关系。</p>
<p>这也是为什么“函数式编程”叫做“函数式编程”。</p>
<p>这是什么意思呢？</p>
<p>假如，现在你来到 google 面试，面试官让你把二叉树镜像反转一下（大雾</p>
<p>几乎不假思索的，就可以写出这样的 Python 代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">invertTree</span><span class="params">(root)</span>:</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> root <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> root.left:</div><div class="line"></div><div class="line">        invertTree(root.left)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> root.right:</div><div class="line"></div><div class="line">        invertTree(root.right)</div><div class="line"></div><div class="line">    root.left, root.right = root.right, root.left</div><div class="line"></div><div class="line">    <span class="keyword">return</span> root</div></pre></td></tr></table></figure>
<p>好了，现在停下来看看这段代码究竟代表着什么——</p>
<p>它的含义是：首先判断节点是否为空；然后翻转左树；然后翻转右树；最后左右互换。</p>
<p>这就是命令式编程——你要做什么事情，你得把达到目的的步骤详细的描述出来，然后交给机器去运行。</p>
<p>这也正是命令式编程的理论模型——图灵机的特点。一条写满数据的纸带，一条根据纸带内容运动的机器，机器每动一步都需要纸带上写着如何达到。</p>
<p>那么，不用这种方式，如何翻转二叉树呢？</p>
<p>函数式思维提供了另一种思维的途径——</p>
<p>所谓“翻转二叉树”，可以看做是要得到一颗和原来二叉树对称的新二叉树。</p>
<p>这颗新二叉树的特点是每一个节点都递归地和原树相反。</p>
<p>用 haskell 代码表达出来就是：</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">data</span> <span class="type">Tree</span> a = <span class="type">Nil</span> | <span class="type">Node</span> a (<span class="type">Tree</span> <span class="title">a</span>) (<span class="type">Tree</span> <span class="title">a</span>)</span></div><div class="line">            <span class="keyword">deriving</span> (<span class="type">Show</span>, <span class="type">Eq</span>)</div><div class="line"></div><div class="line"><span class="title">invert</span> :: <span class="type">Tree</span> a -&gt; <span class="type">Tree</span> a</div><div class="line"><span class="title">invert</span> <span class="type">Nil</span> = <span class="type">Nil</span></div><div class="line"><span class="title">invert</span> (<span class="type">Node</span> v l r) = <span class="type">Node</span> v (invert r) (invert l)</div></pre></td></tr></table></figure>
<p>（防止看不懂，翻译成等价的 python ）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">invert</span><span class="params">(node)</span>:</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="keyword">else</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> Tree(node.value, invert(node.right), invert(node.left))</div></pre></td></tr></table></figure>
<p>这段代码体现的思维，就是旧树到新树的映射——对一颗二叉树而言，它的镜像树就是左右节点递归镜像的树。</p>
<p>这段代码最终达到的目的同样是翻转二叉树，但是它得到结果的方式和 python 代码有着本质的差别：通过描述一个 旧树-&gt;新树 的映射，而不是描述“从旧树得到新树应该怎样做”来达到目的。</p>
<p>那么这样思考有什么好处呢？</p>
<p>首先，最直观的角度来说，函数式风格的代码可以写得很精简，大大减少了键盘的损耗（</p>
<p>更重要的是，函数式的代码是“对映射的描述”，它不仅可以描述二叉树这样的数据结构之间的对应关系，任何能在计算机中体现的东西之间的对应关系都可以描述——比如函数和函数之间的映射（比如 functor）；比如外部操作到 GUI 之间的映射（就是现在前端热炒的所谓 FRP）。它的抽象程度可以很高，这就意味着函数式的代码可以更方便的复用。</p>
<p>同时，将代码写成这种样子可以方便用数学的方法进行研究（这就是为什么可以扯上“___范畴上的___”这种数学上的高深概念）</p>
<p>至于什么科里化、什么数据不可变，都只是外延体现而已。</p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2016/05/14/Let-s-Encrypt/">Let&#39;s Encrypt!</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2016-05-14T05:40:54.000Z" itemprop="datePublished">
    2016-05-14
  </time>
  
  
</div>

    </header>
    <div>
      
        <blockquote>
<p>世界因自由软件而美好。</p>
</blockquote>
<p>昨天（5月13日）发现 SSL 证书到期了。想起之前谭总说过的 Let’s Encrypt，决定体验一下。</p>
<p>相比起<a href="https://tms.im/tms/letsencrypt-beta" target="_blank" rel="external">半年前</a>，这玩意完善了很多、傻瓜了很多。</p>
<p>全程需要做的只需要 clone 一个<a href="https://github.com/certbot/certbot" target="_blank" rel="external">傻瓜工具包</a>，然后运行一行命令</p>
<pre><code class="bash">./certbot-auto certonly --standalone --email admin@hcyue.me <span class="_">-d</span> hcyue.me
</code></pre>
<p>之后坐等几秒，SSL 验证所需要的全部证书就都被放在了 <code>/etc/letsencrypt/live/hcyue.me/</code></p>
<p>然后把 nginx 配置对应的项目修改为生成的 pem 即可。</p>
<p><img src="https://dn-hcyue.qbox.me/img%2FS60514-133728.jpg" alt=""></p>

      
    </div>
</article>

    </li>
  
</ul>

  <section id="nav-wrapper">
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">next »</a>
    </nav>
  </section>


            <footer>
    <div>© 2016 - Hcyue  , CC BY-NC-SA 4.0 </div>
    <div>
    Powered by Hexo
    </div>
</footer>

        </div>
    </div>
</div>
<script src="/js/pager/dist/singlepager.js"></script>
<script>
var sp = new Pager('data-pager-shell')

</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>